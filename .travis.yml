matrix:
  include:
    - language: php
      php: 7.4
      cache:
        directories:
            - vendor
            - $HOME/.composer/cache
      before_script:
        - cp .env.ci .env
        - cp phpunit.xml.test phpunit.xml
        - touch database/database.sqlite
        - composer self-update
        - composer install --no-interaction
        - php artisan key:generate
        - php artisan migrate
      script: composer run test
    - language: php
      cache:
        yarn: true
        directories:
            - vue_app/node_modules
            - vendor
            - $HOME/.composer/cache
      php: 7.4
      env:
        - TEST_DIR=vue_app
      before_script:
        - cp .env.ci .env
        - cp phpunit.xml.test phpunit.xml
        - touch database/database.sqlite
        - composer self-update
        - composer install --no-interaction
        - php artisan key:generate
        - php artisan migrate
        - php artisan serve & APP_PID=$!
        - nvm install stable
        - yarn -v
        - cd $TEST_DIR && yarn
      script:
        - yarn test:unit
        - yarn test:e2e-ci
      after_script:
        - kill $APP_PID
    
    
